<section id="container">
    <header class="header black-bg">
        <div class="sidebar-toggle-box">
            <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
        </div>
        <!--logo start-->
        <a href="http://localhost:3008/products" class="logo"><b>FOOD NICE</b></a>
        <!--logo end-->
        <div class="top-menu">
            <ul class="nav pull-right top-menu">
                <li><a class="logout" href="/dang-xuat">Đăng xuất</a></li>
            </ul>
        </div>
    </header>
    <!--header end-->

    <!-- **********************************************************************************************************************************************************
      MAIN SIDEBAR MENU
      *********************************************************************************************************************************************************** -->
    <!--sidebar start-->
    <aside>
        <div id="sidebar" class="nav-collapse ">
            <!-- sidebar menu start-->
            <ul class="sidebar-menu" id="nav-accordion">

                <p class="centered"><a href="http://localhost:3000/san-pham"><img  src="/images/avatarfood.jpg" class="img-circle" width="60"></a></p>
                <h5 class="centered">ADMIN</h5>
                <li class="mt">
                    <a href="http://localhost:3000/san-pham/addproduct">
                        <i class="fa fa-tasks"></i>
                        <span>Thêm mới sản phẩm</span>
                    </a>
                </li>
                <li class="sub-menu">
                    <a href="http://localhost:3000/san-pham/category/addcategory">
                        <i class="fa fa-tasks"></i>
                        <span>Thêm mới Loại</span>
                    </a>
                </li>
                <li class="sub-menu">
                    <a href="http://localhost:3000/san-pham">
                        <i class="fa fa-th"></i>
                        <span>Danh sách sản phẩm</span>
                    </a>
                </li>
                <li class="sub-menu">
                    <a href="http://localhost:3000/san-pham/category">
                        <i class="fa fa-th"></i>
                        <span>Danh sách loại</span>
                    </a>
                </li>
                <li class="sub-menu">
                    <a href="http://localhost:3008/products/thongke">
                        <i class=" fa fa-bar-chart-o"></i>
                        <span>Thống Kê</span>
                    </a>
                </li>

            </ul>
            <!-- sidebar menu end-->
        </div>
    </aside>
    <!--sidebar end-->

    <!-- **********************************************************************************************************************************************************
      MAIN CONTENT
      *********************************************************************************************************************************************************** -->
    <!--main content start-->
    <section id="main-content">
        <section class="wrapper">
            <h3><i class="fa fa-angle-right"></i> Danh Sách</h3>
            <div class="row mt">
                <div class="col-lg-12">
                    <div class="content-panel">
                        <h4>
                            <i class="fa fa-angle-right"></i> Danh sách sản phẩm
                        </h4>
                        <section id="unseen">
                            <table class="table table-bordered table-striped table-condensed">
                                <thead>
                                    <tr>
                                        {{!-- <th class="numeric">STT</th> --}}
                                        <th class="numeric">Tên sản phẩm</th>
                                        <th class="numeric">Giá tiền</th>
                                        <th class="numeric">Số lượng</th>
                                        <th class="numeric">Loại sản phẩm</th>
                                        <th class="numeric">Mô tả</th>
                                        <th class="numeric">Hình Ảnh</th>
                                        <th class="numeric">Chỉnh Sửa</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{#each products}}
                                    <tr>
                                        {{!-- <td class="numeric">{{this._id}}</td> --}}
                                        <td class="numeric">{{this.name}}</td>
                                        <td class="numeric">{{this.price}}</td>
                                        <td class="numeric">{{this.quantity}}</td>
                                        <td class="numeric">{{this.category_id.name}}</td>
                                        <td class="numeric">{{this.description}}</td>
                                        {{!-- <td class="numeric">{{this.image}}</td> --}}
                                        <td>
                                            <img src="{{this.image}}" width="100" height="100" />
                                        </td>
                                        <td class="numeric">
                                            <button type="button" class="btn btn-theme" onclick="goEdit('{{this._id}}')"><a
                                                    style="color: white;">Cập
                                                    Nhật</a></button>
                                            <button type="button" class="btn btn-theme" onclick="goDelete('{{this._id}}')"
                                                data-toggle="modal" data-target="#confirmModal"><a
                                                    style="color: white;">Xóa</a></button>
                                        </td>
                                    </tr>
                                    {{/each}}
                                </tbody>
                            </table>
                        </section>
                    </div><!-- /content-panel -->
                </div><!-- /col-lg-4 -->
            </div><!-- /row -->
            <div class="row mt">
                <div class="col-lg-12">
                    <div class="content-panel">
                        <h4>
                            <i class="fa fa-angle-right"></i> Loại sản phẩm
                        </h4>
                        <section id="unseen">
                            <table class="table table-bordered table-striped table-condensed">
                                <thead>
                                    <tr>
                                        <th class="numeric">Tên Loại Thú Cưng</th>
                                        <th class="numeric">Mô tả</th>
                                        {{!-- <th class="numeric">Hình ảnh</th> --}}
                                        <th class="numeric">Chỉnh sửa</th>
                                    </tr>
                                </thead>
                                <tbody>
                                     {{#each categories}}
                                    <tr>
                                        <td>{{this.name}}</td>
                                        <td>{{this.description}}</td>
                                        {{!-- <td><img src="" width="100" height="100"></td> --}}
                                        <td class="numeric">
                                            <button type="button" class="btn btn-theme" onclick="edit('')"><a
                                                    style="color: white;">Cập
                                                    Nhật</a></button>
                                            <button type="button" class="btn btn-theme" onclick="goDelete('{{this._id}}')"
                                                data-toggle="modal" data-target="#confirmModal"><a
                                                    style="color: white;">Xóa</a></button>
                                        </td>
                                    </tr>
                                    {{/each}}
                                    {{!-- <tr>
                                        <td>Xiaomi</td>
                                        <td>Rẻ</td>
                                        <td><img src="" width="100" height="100"></td>
                                        <td class="numeric">
                                            <button type="button" class="btn btn-theme" onclick="edit('')"><a
                                                    style="color: white;">Cập
                                                    Nhật</a></button>
                                            <button type="button" class="btn btn-theme" onclick="goDelete('')"
                                                data-toggle="modal" data-target="#confirmModal"><a
                                                    style="color: white;">Xóa</a></button>
                                        </td>
                                    </tr> --}}

                                </tbody>
                            </table>
                        </section>
                    </div><!-- /content-panel -->
                </div><!-- /col-lg-4 -->
            </div><!-- /row -->
        </section>
    </section><!-- /MAIN CONTENT -->

</section>

<!--  Modals-->
<div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">Confirm action</h4>
            </div>
            <div class="modal-body">
                <div class="panel-body">
                    <h3>Are you sure?</h3>
                    <div class="form-group modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <button type="button" onclick="onDelete()" class="btn btn-primary">Yes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End Modals-->

<script>
    let deleted_id;
    const goDelete = (id) => {
        deleted_id = id;
    }

    const fetchAPI = async (url, option) => {
    const res = await fetch(url, option);
    return res.json();
  }

  const onDelete = async () => {
    if(window.location.href.includes('san-pham/category')){
        const url = `http://localhost:3000/san-pham/category/${deleted_id}/delete`;
        const option = {
            method: 'delete',
            headers: {
                'Content-Type': 'application/json'
            }
        }
        try {
            await fetchAPI(url, option);
            window.location.href = 'http://localhost:3000/san-pham/category';
        } catch (error) {
            console.log('Delete error: ',error);
        }
    }
    else{
        const url = `http://localhost:3000/san-pham/${deleted_id}/delete`;
        const option = {
            method: 'delete',
            headers: {
                'Content-Type': 'application/json'
            }
        }
        try {
            await fetchAPI(url, option);
            window.location.href = 'http://localhost:3000/san-pham';
        } catch (error) {
            console.log('Delete error: ',error);
        }

    }
    /**const url = `http://localhost:3000/san-pham/category/${deleted_id}/delete`;
    const option = {
      method: 'delete',
      headers: { 'Content-Type': 'application/json' }
    }
    try {
      await fetchAPI(url, option);
        if (window.location.href.includes('san-pham/category')) {
            window.location.href = 'http://localhost:3000/san-pham/category';
        } else {
            window.location.href = 'http://localhost:3000/san-pham';
        }
    } catch (e) { console.log('Delete error: ', e) }**/
  }

    //edit
    const goEdit = (id) => {
    //http://localhost:3000/san-pham/:id/edit
    window.location.href = `/san-pham/${id}/edit/`
  }

</script>